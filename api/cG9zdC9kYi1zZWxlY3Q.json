{"title":"MySQL数据库查询","date":"2018-12-26T09:09:40.000Z","slug":"db-select","categories":["数据库"],"updated":"2018-12-26T09:12:33.116Z","content":"<h1 id=\"学生表\"><a href=\"#学生表\" class=\"headerlink\" title=\"学生表\"></a>学生表</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- 创建SRS数据库</span><br><span class=\"line\">drop database if exists SRS;</span><br><span class=\"line\">create database SRS default charset utf8 collate utf8_bin;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 切换到SRS数据库</span><br><span class=\"line\">use SRS;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 创建学院表</span><br><span class=\"line\">create table tb_college</span><br><span class=\"line\">(</span><br><span class=\"line\">collid int not null auto_increment comment &apos;学院编号&apos;,</span><br><span class=\"line\">collname varchar(50) not null comment &apos;学院名称&apos;,</span><br><span class=\"line\">collmaster varchar(20) not null comment &apos;院长姓名&apos;,</span><br><span class=\"line\">collweb varchar(511) default &apos;&apos; comment &apos;学院网站&apos;,</span><br><span class=\"line\">primary key (collid)</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 添加唯一约束</span><br><span class=\"line\">alter table tb_college add constraint uni_college_collname unique (collname);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 创建学生表</span><br><span class=\"line\">create table tb_student</span><br><span class=\"line\">(</span><br><span class=\"line\">stuid int not null comment &apos;学号&apos;,</span><br><span class=\"line\">sname varchar(20) not null comment &apos;学生姓名&apos;,</span><br><span class=\"line\">gender bit default 1 comment &apos;性别&apos;,</span><br><span class=\"line\">birth date not null comment &apos;出生日期&apos;,</span><br><span class=\"line\">addr varchar(255) default &apos;&apos; comment &apos;籍贯&apos;,</span><br><span class=\"line\">collid int not null comment &apos;所属学院编号&apos;,</span><br><span class=\"line\">primary key (stuid)</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 添加外键约束</span><br><span class=\"line\">alter table tb_student add constraint fk_student_collid foreign key (collid) references tb_college (collid);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 创建教师表</span><br><span class=\"line\">create table tb_teacher</span><br><span class=\"line\">(</span><br><span class=\"line\">teaid int not null comment &apos;教师工号&apos;,</span><br><span class=\"line\">tname varchar(20) not null comment &apos;教师姓名&apos;,</span><br><span class=\"line\">title varchar(10) default &apos;&apos; comment &apos;职称&apos;,</span><br><span class=\"line\">collid int not null comment &apos;所属学院编号&apos;</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 添加主键约束</span><br><span class=\"line\">alter table tb_teacher add constraint pk_teacher primary key (teaid);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 添加外键约束</span><br><span class=\"line\">alter table tb_teacher add constraint fk_teacher_collid foreign key (collid) references tb_college (collid);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 创建课程表</span><br><span class=\"line\">create table tb_course</span><br><span class=\"line\">(</span><br><span class=\"line\">couid int not null comment &apos;课程编号&apos;,</span><br><span class=\"line\">cname varchar(50) not null comment &apos;课程名称&apos;,</span><br><span class=\"line\">credit tinyint not null comment &apos;学分&apos;,</span><br><span class=\"line\">teaid int not null comment &apos;教师工号&apos;,</span><br><span class=\"line\">primary key (couid)</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 添加外键约束</span><br><span class=\"line\">alter table tb_course add constraint fk_course_tid foreign key (teaid) references tb_teacher (teaid);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 创建学生选课表</span><br><span class=\"line\">create table tb_score</span><br><span class=\"line\">(</span><br><span class=\"line\">scid int not null auto_increment comment &apos;选课编号&apos;,</span><br><span class=\"line\">sid int not null comment &apos;学号&apos;,</span><br><span class=\"line\">cid int not null comment &apos;课程编号&apos;,</span><br><span class=\"line\">seldate date comment &apos;选课时间日期&apos;,</span><br><span class=\"line\">mark decimal(4,1) comment &apos;考试成绩&apos;,</span><br><span class=\"line\">primary key (scid)</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 添加外键约束</span><br><span class=\"line\">alter table tb_score add constraint fk_score_sid foreign key (sid) references tb_student (stuid);</span><br><span class=\"line\">alter table tb_score add constraint fk_score_cid foreign key (cid) references tb_course (couid);</span><br><span class=\"line\">-- 添加唯一约束</span><br><span class=\"line\">alter table tb_score add constraint uni_score_sid_cid unique (sid, cid);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-- 插入学院数据</span><br><span class=\"line\">insert into tb_college (collname, collmaster, collweb) values </span><br><span class=\"line\">(&apos;计算机学院&apos;, &apos;左冷禅&apos;, &apos;http://www.abc.com </span><br><span class=\"line\"></span><br><span class=\"line\">&apos;),</span><br><span class=\"line\">(&apos;外国语学院&apos;, &apos;岳不群&apos;, &apos;http://www.xyz.com </span><br><span class=\"line\"></span><br><span class=\"line\">&apos;),</span><br><span class=\"line\">(&apos;经济管理学院&apos;, &apos;风清扬&apos;, &apos;http://www.foo.com </span><br><span class=\"line\"></span><br><span class=\"line\">&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 插入学生数据</span><br><span class=\"line\">insert into tb_student (stuid, sname, gender, birth, addr, collid) values</span><br><span class=\"line\">(1001, &apos;杨逍&apos;, 1, &apos;1990-3-4&apos;, &apos;四川成都&apos;, 1),</span><br><span class=\"line\">(1002, &apos;任我行&apos;, 1, &apos;1992-2-2&apos;, &apos;湖南长沙&apos;, 1),</span><br><span class=\"line\">(1033, &apos;王语嫣&apos;, 0, &apos;1989-12-3&apos;, &apos;四川成都&apos;, 1),</span><br><span class=\"line\">(1572, &apos;岳不群&apos;, 1, &apos;1993-7-19&apos;, &apos;陕西咸阳&apos;, 1),</span><br><span class=\"line\">(1378, &apos;纪嫣然&apos;, 0, &apos;1995-8-12&apos;, &apos;四川绵阳&apos;, 1),</span><br><span class=\"line\">(1954, &apos;林平之&apos;, 1, &apos;1994-9-20&apos;, &apos;福建莆田&apos;, 1),</span><br><span class=\"line\">(2035, &apos;东方不败&apos;, 1, &apos;1988-6-30&apos;, null, 2),</span><br><span class=\"line\">(3011, &apos;林震南&apos;, 1, &apos;1985-12-12&apos;, &apos;福建莆田&apos;, 3),</span><br><span class=\"line\">(3755, &apos;项少龙&apos;, 1, &apos;1993-1-25&apos;, null, 3),</span><br><span class=\"line\">(3923, &apos;杨不悔&apos;, 0, &apos;1985-4-17&apos;, &apos;四川成都&apos;, 3);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 插入老师数据</span><br><span class=\"line\">insert into tb_teacher (teaid, tname, title, collid) values </span><br><span class=\"line\">(1122, &apos;张三丰&apos;, &apos;教授&apos;, 1),</span><br><span class=\"line\">(1133, &apos;宋远桥&apos;, &apos;副教授&apos;, 1),</span><br><span class=\"line\">(1144, &apos;杨逍&apos;, &apos;副教授&apos;, 1),</span><br><span class=\"line\">(2255, &apos;范遥&apos;, &apos;副教授&apos;, 2),</span><br><span class=\"line\">(3366, &apos;韦一笑&apos;, &apos;讲师&apos;, 3);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 插入课程数据</span><br><span class=\"line\">insert into tb_course (couid, cname, credit, teaid) values </span><br><span class=\"line\">(1111, &apos;Python程序设计&apos;, 3, 1122),</span><br><span class=\"line\">(2222, &apos;Web前端开发&apos;, 2, 1122),</span><br><span class=\"line\">(3333, &apos;操作系统&apos;, 4, 1122),</span><br><span class=\"line\">(4444, &apos;计算机网络&apos;, 2, 1133),</span><br><span class=\"line\">(5555, &apos;编译原理&apos;, 4, 1144),</span><br><span class=\"line\">(6666, &apos;算法和数据结构&apos;, 3, 1144),</span><br><span class=\"line\">(7777, &apos;经贸法语&apos;, 3, 2255),</span><br><span class=\"line\">(8888, &apos;成本会计&apos;, 2, 3366),</span><br><span class=\"line\">(9999, &apos;审计学&apos;, 3, 3366);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 插入选课数据</span><br><span class=\"line\">insert into tb_score (sid, cid, seldate, mark) values </span><br><span class=\"line\">(1001, 1111, &apos;2017-09-01&apos;, 95),</span><br><span class=\"line\">(1001, 2222, &apos;2017-09-01&apos;, 87.5),</span><br><span class=\"line\">(1001, 3333, &apos;2017-09-01&apos;, 100),</span><br><span class=\"line\">(1001, 4444, &apos;2018-09-03&apos;, null),</span><br><span class=\"line\">(1001, 6666, &apos;2017-09-02&apos;, 100),</span><br><span class=\"line\">(1002, 1111, &apos;2017-09-03&apos;, 65),</span><br><span class=\"line\">(1002, 5555, &apos;2017-09-01&apos;, 42),</span><br><span class=\"line\">(1033, 1111, &apos;2017-09-03&apos;, 92.5),</span><br><span class=\"line\">(1033, 4444, &apos;2017-09-01&apos;, 78),</span><br><span class=\"line\">(1033, 5555, &apos;2017-09-01&apos;, 82.5),</span><br><span class=\"line\">(1572, 1111, &apos;2017-09-02&apos;, 78),</span><br><span class=\"line\">(1378, 1111, &apos;2017-09-05&apos;, 82),</span><br><span class=\"line\">(1378, 7777, &apos;2017-09-02&apos;, 65.5),</span><br><span class=\"line\">(2035, 7777, &apos;2018-09-03&apos;, 88),</span><br><span class=\"line\">(2035, 9999, date(now()), null),</span><br><span class=\"line\">(3755, 1111, date(now()), null),</span><br><span class=\"line\">(3755, 8888, date(now()), null),</span><br><span class=\"line\">(3755, 9999, &apos;2017-09-01&apos;, 92);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询所有学生信息</span><br><span class=\"line\">select * from tb_student;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询所有课程名称及学分(投影和别名 as可省略)</span><br><span class=\"line\">select cname as 课程名称,credit 学分 from tb_course;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询所有女学生的姓名和出生日期(筛选)</span><br><span class=\"line\">select sname as 姓名,birth as 出生日期 from tb_student where gender=0;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询所有80后学生的姓名、性别和出生日期(筛选)</span><br><span class=\"line\">select sname as 姓名,case gender when 1 then &apos;男&apos; else &apos;女&apos; end as 性别,birth 出生日期 from tb_student where birth between &apos;1980-1-1&apos; and &apos;1989-12-31&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 写法二(使用MySQL中的分支函数)</span><br><span class=\"line\">select sname as 姓名,if(gender, &apos;男&apos;, &apos;女&apos;) as 性别,birth 出生日期 from tb_student where birth between &apos;1980-1-1&apos; and &apos;1989-12-31&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">--查询名字有四个中文字符的学生学号和姓名(函数)</span><br><span class=\"line\">select stuid as 学号, sname as 姓名 from tb_student where length(sname)/3=4;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询姓”杨“的学生姓名和性别(模糊)</span><br><span class=\"line\">select sname as 姓名,if(gender, &apos;男&apos;, &apos;女&apos;) as 性别 from tb_student where sname like &apos;杨%&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询姓”杨“名字两个字的学生姓名和性别(模糊)</span><br><span class=\"line\">select sname as 姓名, if(gender, &apos;男&apos;, &apos;女&apos;) as 性别 from tb_student where sname like &apos;杨_&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询姓”杨“名字三个字的学生姓名和性别(模糊)</span><br><span class=\"line\">select sname as 姓名, if(gender, &apos;男&apos;, &apos;女&apos;) as 性别 from tb_student where sname like &apos;杨__&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询名字中有”不“字或“嫣”字的学生的姓名(模糊)</span><br><span class=\"line\">select sname as 姓名, if(gender, &apos;男&apos;, &apos;女&apos;) as 性别 from tb_student where sname like &apos;%不%&apos; or sname like &apos;%嫣%&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询没有录入家庭住址的学生姓名(空值或者空字符串 - 录入的时候只包含空格会被自动去掉)</span><br><span class=\"line\">select sname as 姓名 from tb_student where addr is null or addr=&apos;&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询录入了家庭住址的学生姓名</span><br><span class=\"line\">select sname as 姓名 from tb_student where addr is not null and addr&lt;&gt;&apos;&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询学生选课的所有日期(去重)</span><br><span class=\"line\">select distinct seldate from tb_score;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询学生的家庭住址(去重)</span><br><span class=\"line\">select distinct addr from tb_student where addr is not null and addr&lt;&gt;&apos;&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询男学生的姓名和生日按年龄从大到小排列(排序)</span><br><span class=\"line\">-- 升序asc默认，降序desc</span><br><span class=\"line\">select sname,birth from tb_student where gender=1 order by year(now()) - year(birth);</span><br><span class=\"line\"></span><br><span class=\"line\">select * from tb_student order by gender,stuid desc;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-- 聚合函数：min / max / count / sun / avg  空值不会计算在内</span><br><span class=\"line\">-- 查询年龄最大的学生的出生日期(聚合函数)</span><br><span class=\"line\">select min(birth) from tb_student;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询年龄最小的学生的出生日期(聚合函数)</span><br><span class=\"line\">select max(birth) from tb_student;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询男女学生的人数(分组和聚合函数)</span><br><span class=\"line\">select gender as 性别,count(gender) as 人数 from tb_student group by gender;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询课程编号为1111的课程的平均成绩(筛选和聚合函数)</span><br><span class=\"line\">select avg(mark) as 平均分数 from tb_score where cid=1111;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询学号为1001的学生所有课程的平均分(筛选和聚合函数)</span><br><span class=\"line\">select avg(mark) from tb_score where sid=1001;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询每个学生的学号和平均成绩(分组和聚合函数)</span><br><span class=\"line\">select sid,avg(mark) from tb_score group by sid;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询平均成绩大于等于90分的学生的学号和平均成绩</span><br><span class=\"line\">select sid,avg(mark) from tb_score group by sid having avg(mark)&gt;=90;</span><br><span class=\"line\">-- WHERE子句中是不能用聚集函数作为条件表达式</span><br><span class=\"line\">-- 分组之前用where,分组之后用having</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询年龄最大的学生的姓名(子查询)</span><br><span class=\"line\">select sname from tb_student where birth in (select min(birth) from tb_student);</span><br><span class=\"line\">-- 将一个查询块嵌套在另一个查询块的WHERE子句或HAVING短语的条件中的查询称为嵌套查询/子查询</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询年龄最大的学生姓名和年龄(子查询+运算)</span><br><span class=\"line\">select sname,year(now())-year(birth) as 年龄 from tb_student where birth=(select min(birth) from tb_student);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询选了两门以上的课程的学生姓名(子查询/分组条件/集合运算)</span><br><span class=\"line\">select sname from tb_student where stuid in (select sid from tb_score group by sid having count(sid)&gt;2);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询学生姓名、课程名称以及成绩(连接查询)</span><br><span class=\"line\">-- 连接查询时如果没有连表条件，将形成笛卡尔积</span><br><span class=\"line\">-- limit x offset y  --x控制查询结果显示几条，y表示从第几条之后开始查询</span><br><span class=\"line\">-- limit x,y         --x控制从第几条开始查，y表示查几条</span><br><span class=\"line\">select sname,cname,mark from tb_student,tb_course,tb_score where stuid=sid and couid=cid;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 内连接</span><br><span class=\"line\">select sname,cname,mark </span><br><span class=\"line\">from tb_student inner join tb_score on stuid=sid</span><br><span class=\"line\">inner join tb_course on couid=cid</span><br><span class=\"line\">limit 5 offset 5;</span><br><span class=\"line\"></span><br><span class=\"line\">select sname,cname,mark </span><br><span class=\"line\">from tb_student inner join tb_score on stuid=sid</span><br><span class=\"line\">inner join tb_course on couid=cid</span><br><span class=\"line\">limit 5,5;</span><br><span class=\"line\">-- 查询选课学生的姓名和平均成绩(子查询和连接查询)</span><br><span class=\"line\">select sname,avg(mark) from tb_student,tb_score where tb_student.stuid=tb_score.sid group by sname;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询每个学生的姓名和选课数量(左外连接和子查询)</span><br><span class=\"line\">-- inner join 内连接:只能将满足条件的记录查询出来</span><br><span class=\"line\">-- 左外连接：将左表不满足条件的记录也要查出来</span><br><span class=\"line\">-- 右外连接：将右表不满足条件的记录也要查出来</span><br><span class=\"line\">-- 连接多表查询时，写在左边的表称为左表，右边的表称为右表</span><br><span class=\"line\">-- left outer join/right outer join</span><br><span class=\"line\">-- MySQL不支持全外连接 full outer join</span><br><span class=\"line\">select sname,count(sid) from tb_student left outer join tb_score on stuid=sid group by sname;</span><br><span class=\"line\"></span><br><span class=\"line\">-- ifnull(total, 0)可以将空值变为0</span><br><span class=\"line\">select sname as 姓名, total as 选课数量 </span><br><span class=\"line\">from tb_student t1 </span><br><span class=\"line\">left join (select sid, count(sid) as total </span><br><span class=\"line\">from tb_score group by sid) t2 </span><br><span class=\"line\">on stuid=sid;</span><br></pre></td></tr></table></figure>\n<h1 id=\"部门表\"><a href=\"#部门表\" class=\"headerlink\" title=\"部门表\"></a>部门表</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- 创建人力资源管理系统数据库</span><br><span class=\"line\">drop database if exists HRS;</span><br><span class=\"line\">create database HRS default charset utf8;</span><br><span class=\"line\">-- 切换数据库上下文环境</span><br><span class=\"line\">use HRS;</span><br><span class=\"line\">-- 删除表</span><br><span class=\"line\">drop table if exists TbEmp;</span><br><span class=\"line\">drop table if exists TbDept;</span><br><span class=\"line\">-- 创建部门表</span><br><span class=\"line\">create table TbDept</span><br><span class=\"line\">(</span><br><span class=\"line\">deptno tinyint primary key,\t-- 部门编号</span><br><span class=\"line\">dname varchar(10) not null,\t-- 部门名称</span><br><span class=\"line\">dloc varchar(20) not null\t-- 部门所在地</span><br><span class=\"line\">);</span><br><span class=\"line\">-- 添加部门记录</span><br><span class=\"line\">insert into TbDept values (10, &apos;会计部&apos;, &apos;北京&apos;);</span><br><span class=\"line\">insert into TbDept values (20, &apos;研发部&apos;, &apos;成都&apos;);</span><br><span class=\"line\">insert into TbDept values (30, &apos;销售部&apos;, &apos;重庆&apos;);</span><br><span class=\"line\">insert into TbDept values (40, &apos;运维部&apos;, &apos;深圳&apos;);</span><br><span class=\"line\">-- 创建员工表</span><br><span class=\"line\">create table TbEmp</span><br><span class=\"line\">(</span><br><span class=\"line\">empno int primary key,\t\t-- 员工编号</span><br><span class=\"line\">ename varchar(20) not null,\t-- 员工姓名</span><br><span class=\"line\">job varchar(20) not null,\t-- 员工职位</span><br><span class=\"line\">mgr int,\t\t\t\t\t-- 主管编号</span><br><span class=\"line\">sal int not null,\t\t\t-- 员工月薪</span><br><span class=\"line\">comm int,\t\t\t\t\t-- 每月补贴</span><br><span class=\"line\">dno tinyint\t\t\t\t\t-- 所在部门编号</span><br><span class=\"line\">);</span><br><span class=\"line\">-- 添加外键约束</span><br><span class=\"line\">alter table TbEmp add constraint fk_dno foreign key (dno) references TbDept(deptno);</span><br><span class=\"line\">-- 添加员工记录</span><br><span class=\"line\">insert into TbEmp values (7800, &apos;张三丰&apos;, &apos;总裁&apos;, null, 9000, 1200, 20);</span><br><span class=\"line\">insert into TbEmp values (2056, &apos;乔峰&apos;, &apos;分析师&apos;, 7800, 5000, 1500, 20);</span><br><span class=\"line\">insert into TbEmp values (3088, &apos;李莫愁&apos;, &apos;设计师&apos;, 2056, 3500, 800, 20);</span><br><span class=\"line\">insert into TbEmp values (3211, &apos;张无忌&apos;, &apos;程序员&apos;, 2056, 3200, null, 20);</span><br><span class=\"line\">insert into TbEmp values (3233, &apos;丘处机&apos;, &apos;程序员&apos;, 2056, 3400, null, 20);</span><br><span class=\"line\">insert into TbEmp values (3251, &apos;张翠山&apos;, &apos;程序员&apos;, 2056, 4000, null, 20);</span><br><span class=\"line\">insert into TbEmp values (5566, &apos;宋远桥&apos;, &apos;会计师&apos;, 7800, 4000, 1000, 10);</span><br><span class=\"line\">insert into TbEmp values (5234, &apos;郭靖&apos;, &apos;出纳&apos;, 5566, 2000, null, 10);</span><br><span class=\"line\">insert into TbEmp values (3344, &apos;黄蓉&apos;, &apos;销售主管&apos;, 7800, 3000, 800, 30);</span><br><span class=\"line\">insert into TbEmp values (1359, &apos;胡一刀&apos;, &apos;销售员&apos;, 3344, 1800, 200, 30);</span><br><span class=\"line\">insert into TbEmp values (4466, &apos;苗人凤&apos;, &apos;销售员&apos;, 3344, 2500, null, 30);</span><br><span class=\"line\">insert into TbEmp values (3244, &apos;欧阳锋&apos;, &apos;程序员&apos;, 3088, 3200, null, 20);</span><br><span class=\"line\">insert into TbEmp values (3577, &apos;杨过&apos;, &apos;会计&apos;, 5566, 2200, null, 10);</span><br><span class=\"line\">insert into TbEmp values (3588, &apos;朱九真&apos;, &apos;会计&apos;, 5566, 2500, null, 10);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询薪资最高的员工姓名和工资</span><br><span class=\"line\">select ename,sal from TbEmp where sal=(select max(sal) from TbEmp);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询员工的姓名和年薪((月薪+补贴)*12)</span><br><span class=\"line\">select ename,ifnull((sal+comm)*12,0) as Annual_salary from TbEmp;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询所有员工的部门的编号和人数</span><br><span class=\"line\">select deptno,count(empno) from TbDept left outer join TbEmp on deptno=dno group by deptno;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询所有部门的名称和人数</span><br><span class=\"line\">select dname,count(empno) from TbDept left outer join TbEmp on deptno=dno group by dname;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询薪资最高的员工(Boss除外)的姓名和工资</span><br><span class=\"line\">select ename,sal from TbEmp where sal in (select max(sal) from TbEmp where job&lt;&gt;&apos;总裁&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询薪水超过平均薪水的员工的姓名和工资</span><br><span class=\"line\">select ename,sal from TbEmp where sal&gt;(select avg(sal) from TbEmp);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询薪水超过其所在部门平均薪水的员工的姓名、部门编号和工资</span><br><span class=\"line\">-- 要注意group by的使用方法,各表中有相同名字的列，要明确所要查询的列是那个表的</span><br><span class=\"line\">select dno,ename,sal</span><br><span class=\"line\">from TbEmp,(select deptno,dname,avg(sal) avg_sal from TbEmp,TbDept where TbEmp.dno=TbDept.deptno group by deptno) as t1</span><br><span class=\"line\">where TbEmp.dno=t1.deptno and sal&gt;avg_sal;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询部门中薪水最高的人姓名、工资和所在部门名称</span><br><span class=\"line\">select dname,ifnull(ename,0),ifnull(sal,0)</span><br><span class=\"line\">from TbEmp right join (select deptno,dname,max(sal) max_sal from TbEmp right join TbDept on TbEmp.dno=TbDept.deptno group by deptno) as t1</span><br><span class=\"line\">on TbEmp.dno=t1.deptno and sal=max_sal;</span><br><span class=\"line\"></span><br><span class=\"line\">-- 查询主管的姓名和职位</span><br><span class=\"line\">select ename,job from TbEmp where empno in (select distinct mgr from TbEmp where mgr is not null);</span><br><span class=\"line\"></span><br><span class=\"line\">-- 集合运算和去重操作性能都非常糟糕应该尽量避免使用</span><br><span class=\"line\">-- 可以使用exists和not exists来替代集合运算和去重</span><br><span class=\"line\">select ename,job from TbEmp t1 where exists (select &apos;x&apos; from TbEmp t2 where t1.empno=t2.mgr);</span><br><span class=\"line\">-- 查询薪资排名4~6名的员工姓名和工资</span><br><span class=\"line\">select ename,sal from TbEmp order by sal desc limit 3,3;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-- select</span><br><span class=\"line\">-- from</span><br><span class=\"line\">-- where</span><br><span class=\"line\">-- group by</span><br><span class=\"line\">-- having</span><br><span class=\"line\">-- orderby</span><br><span class=\"line\">-- limit</span><br></pre></td></tr></table></figure>\n","prev":{"title":"数据库新建用户和权限的给与收","slug":"数据库新建用户和权限的给与收"},"next":{"title":"vim-error","slug":"vim-error"},"link":"http://yoursite.com/post/db-select/","toc":[{"title":"学生表","id":"学生表","index":"1"},{"title":"部门表","id":"部门表","index":"2"}]}